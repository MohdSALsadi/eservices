@inject eservices.Services.IUserService _userService;
@inject Pattern_of_life.Services.INotficationService _notificationService;
@{
    var user = (System.Security.Claims.ClaimsIdentity)User.Identity;
    var isAdmin = user.Claims.Any(c => c.Type == System.Security.Claims.ClaimTypes.Role && c.Value == "Admin");
    var isManager = user.Claims.Any(c => c.Type == System.Security.Claims.ClaimTypes.Role && c.Value == "Manager");
    var departmentName = user.Claims.FirstOrDefault(c => c.Type == "DepartmentName")?.Value;
    // var countOfNewRequests = _requestService.GetCountRequests("NEW");
    var countOfActiveUsers = _userService.GetCountInActiveUsers();
    var notifications = _notificationService.GetAllCoreNotification();
}
<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="rtl">
<!-- BEGIN: Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Modern admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities with bitcoin dashboard.">
    <meta name="keywords" content="admin template, modern admin template, dashboard template, flat admin template, responsive admin template, web app, crypto dashboard, bitcoin dashboard">
    <meta name="author" content="PIXINVENT">
    <title></title>
    <link rel="apple-touch-icon" href="~/images/ico/apple-icon-120.png">

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/toastr/toastr.min.js"></script>


    <link rel="shortcut icon" type="image/x-icon" href="~/images/ico/favicon.ico">

    <link href="~/fonts/quicksand.css" rel="stylesheet" />
    <link href="~/fonts/rubik.css" rel="stylesheet" />




    <!-- BEGIN: Vendor CSS-->
    <!-- END: Page CSS-->
    <!-- BEGIN: Custom CSS-->
    @*    @if (ViewBag.Language == "Arabic") *@


    <link rel="stylesheet" type="text/css" href="~/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="~/css/ltr/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="~/css/ltr/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="~/css/ltr/colors.css">
    <link rel="stylesheet" type="text/css" href="~/css/ltr/components.css">
    <link rel="stylesheet" type="text/css" href="~/css/ltr/core/menu/menu-types/vertical-menu.css">
    <link href="~/css/ltr/core/colors/palette-gradient.css" rel="stylesheet" />
    <link href="~/fonts/simple-line-icons/style.css" rel="stylesheet" />
    <link href="~/css/ltr/core/colors/palette-gradient.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/css/style.css">
    <link href="~/js/toastr/toastr.min.css" rel="stylesheet" />
    <script>
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": false,
            "progressBar": true,
            "positionClass": "toast-bottom-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
    </script>

    <!-- END: Custom CSS-->

    <style>
        body {
            font-family: 'Rubik', sans-serif;
        }
    </style>

    <script>

        $(() => {

            $(document).ajaxStart(function () {
                $('#loader').show();
            });

            $(document).ajaxStop(function () {
                $('#loader').hide();
            });

        })
    </script>

    <style>
        #loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            text-align: center;
            padding-top: 22%;
        }
    </style>
</head>
<!-- END: Head-->
<!-- BEGIN: Body-->

<body class="vertical-layout vertical-menu 2-columns   fixed-navbar" data-open="click" data-menu="vertical-menu" data-col="2-columns">
    <div id="loader">
        <img src="~/images/loader.gif" alt="Loading..." style="width:6%;" />
    </div>
    <nav class="header-navbar navbar-expand-md navbar navbar-with-menu navbar-without-dd-arrow fixed-top navbar-semi-light bg-info navbar-shadow">
        <div class="navbar-wrapper">
            <div class="navbar-header">
                <ul class="nav navbar-nav flex-row">
                    <li class="nav-item mobile-menu d-md-none mr-auto"><a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#"><i class="ft-menu font-large-1"></i></a></li>
                    <li class="nav-item">
                        <a class="navbar-brand" href="index.html">
                            <img class="brand-logo" alt="modern admin logo" src="~/images/logo/POL.jpg">
                            <h3 class="brand-text" style="zoom:0.9;">Pattern Of Life</h3>
                        </a>
                    </li>
                    <li class="nav-item d-md-none"><a class="nav-link open-navbar-container" data-toggle="collapse" data-target="#navbar-mobile"><i class="la la-ellipsis-v"></i></a></li>
                </ul>
            </div>
            <div class="navbar-container content">
                <div class="collapse navbar-collapse" id="navbar-mobile">
                    <ul class="nav navbar-nav mr-auto float-left">
                        <li class="nav-item d-none d-md-block"><a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#"><i class="ft-menu"></i></a></li>
                        <li class="nav-item d-none d-lg-block"><a class="nav-link nav-link-expand" href="#"><i class="ficon ft-maximize"></i></a></li>
                        <li class="dropdown nav-item mega-dropdown d-none d-lg-block">
                          
                            <ul class="mega-dropdown-menu dropdown-menu row p-1">
                                <li class="col-md-4 bg-mega p-2">
                                    <h3 class="text-white mb-1 font-weight-bold">Mega Menu Sidebar</h3>
                                    <p class="text-white line-height-2">Candy canes bonbon toffee. Cheesecake dragée gummi bears chupa chups powder bonbon. Apple pie cookie sweet.</p>
                                    <button class="btn btn-outline-white">Learn More</button>
                                </li>
                                <li class="col-md-5 px-2">
                                    <h6 class="font-weight-bold font-medium-2 ml-1">Admin Panel</h6>
                                    <ul class="row mt-2">
                                        <li class="col-6 col-xl-4">
                                            <a class="text-center mb-2 mb-xl-3" href="../ecommerce-menu-template" target="_blank">
                                                <i class="la la-shopping-cart font-large-1 mr-0"></i>
                                                <p class="font-medium-2 mt-25 mb-0">eCommerce</p>
                                            </a>
                                        </li>
                                        <li class="col-6 col-xl-4">
                                            <a class="text-center mb-2 mb-xl-3" href="../travel-menu-template" target="_blank">
                                                <i class="la la-plane font-large-1 mr-0"></i>
                                                <p class="font-medium-2 mt-25 mb-0">Travel</p>
                                            </a>
                                        </li>
                                        <li class="col-6 col-xl-4">
                                            <a class="text-center mb-2 mb-xl-3 mt-75 mt-xl-0" href="../hospital-menu-template" target="_blank">
                                                <i class="la la-stethoscope font-large-1 mr-0"></i>
                                                <p class="font-medium-2 mt-25 mb-0">Hospital</p>
                                            </a>
                                        </li>
                                        <li class="col-6 col-xl-4">
                                            <a class="text-center mb-2 mt-75 mt-xl-0" href="../crypto-menu-template" target="_blank">
                                                <i class="la la-bitcoin font-large-1 mr-0"></i>
                                                <p class="font-medium-2 mt-25 mb-50">Crypto</p>
                                            </a>
                                        </li>
                                        <li class="col-6 col-xl-4">
                                            <a class="text-center mb-2 mt-75 mt-xl-0" href="../support-menu-template" target="_blank">
                                                <i class="la la-tag font-large-1 mr-0"></i>
                                                <p class="font-medium-2 mt-25 mb-50">Support</p>
                                            </a>
                                        </li>
                                        <li class="col-6 col-xl-4">
                                            <a class="text-center mb-2 mt-75 mt-xl-0" href="../bank-menu-template" target="_blank">
                                                <i class="la la-bank font-large-1 mr-0"></i>
                                                <p class="font-medium-2 mt-25 mb-50">Bank</p>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="col-md-3">
                                    <h6 class="font-weight-bold font-medium-2">Components</h6>
                                    <ul class="row mt-1 mt-xl-2">
                                        <li class="col-12 col-xl-6 pl-0">
                                            <ul class="mega-component-list">
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-alerts.html" target="_blank">Alert</a></li>
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-callout.html" target="_blank">Callout</a></li>
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-buttons-basic.html" target="_blank">Buttons</a></li>
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-carousel.html" target="_blank">Carousel</a></li>
                                            </ul>
                                        </li>
                                        <li class="col-12 col-xl-6 pl-0">
                                            <ul class="mega-component-list">
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-dropdowns.html" target="_blank">Drop Down</a></li>
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-list-group.html" target="_blank">List Group</a></li>
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-modals.html" target="_blank">Modals</a></li>
                                                <li class="mega-component-item"><a class="mb-1 mb-xl-2" href="component-pagination.html" target="_blank">Pagination</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item nav-search">
                            <a class="nav-link nav-link-search" href="#"><i class="ficon ft-search"></i></a>
                            <div class="search-input">
                                <input class="input" type="text" placeholder="Explore Modern..." tabindex="0" data-search="template-list">
                                <div class="search-input-close"><i class="ft-x"></i></div>
                                <ul class="search-list"></ul>
                            </div>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav float-right">
                

                       @*  @if (isAdmin)
                        { *@
                            <li class="dropdown dropdown-notification nav-item">
                            <a class="nav-link nav-link-label" href="#" data-toggle="dropdown">
                                <i class="ficon ft-bell"></i>@if (@notifications.Count>0)
                                {
                                    <span class="badge badge-pill badge-danger badge-up badge-glow">@notifications.Count</span>
                                }</a>
                                <ul class="dropdown-menu dropdown-menu-media dropdown-menu-right">
                                    <li class="dropdown-menu-header">
                                        <h6 class="dropdown-header m-0"><span class="grey darken-2">Messages</span></h6><span class="notification-tag badge badge-danger float-right m-0">@notifications.Count New</span>
                                    </li>

                                    @foreach (var item in notifications)
                                    {
                                        <li class="scrollable-container media-list w-100">



                                            <a href="javascript:void(0)" onclick="read(@item.Id)">
                                                <div class="media">
                                                    <div class="media-left align-self-center"><i class="ft-check-circle icon-bg-circle bg-cyan mr-0"></i></div>
                                                    <div class="media-body">
                                                        <h6 class="media-heading">@item.Message</h6><small>
                                                            <time class="media-meta text-muted" datetime="@item.CreatedOn.ToString("dd/MM/yyyy")">@item.CreatedOn.ToString("dd/MM/yyyy")</time>
                                                        </small>
                                                    </div>
                                                </div>

                                        </li>
                                    }


                                    <li class="dropdown-menu-footer"><a onclick="readAll()" class="dropdown-item text-muted text-center" href="javascript:void(0)">Read All</a></li>
                                </ul>
                            </li>
                       @*  } *@
                    
                        <li class="dropdown dropdown-user nav-item">
                            <a class="dropdown-toggle nav-link dropdown-user-link" href="#" data-toggle="dropdown"><span class="mr-1 user-name">Welcome @User.Identity.Name |  <i style="display:@(string.IsNullOrEmpty(departmentName)?"none":"")">@departmentName</i> </span><span class="avatar avatar-online"><img src="~/images/portrait/small/avatar-s-19.png" alt="avatar"><i></i></span></a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <div class="dropdown-divider"></div><a class="dropdown-item" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Login", "Account", new { area = "Identity" })"><i class="ft-power"></i>logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>


    <div class="main-menu menu-fixed menu-light menu-accordion    menu-shadow " data-scroll-to-active="true">
        <div class="main-menu-content">
            <ul class="navigation navigation-main" id="main-menu-navigation" data-menu="menu-navigation">

                @* @if (isAdmin || isManager){ *@
                
                    <li class=" nav-item">
                    <a href="@Url.Action("index","Dashboard")"><i class="la la-home"></i><span class="menu-title" data-i18n="Dashboard">Dashboard</span><span class="badge badge badge-info badge-pill float-right mr-2"></span></a>
                    </li>
                <li class=" navigation-header">
                    <span>User Managements</span><i class="la la-ellipsis-h" data-toggle="tooltip" data-placement="right" data-original-title="User Managements "></i>
                </li>
                <li class=" nav-item">
                    <a href="@Url.Action("index","account")">
                        <i class="la la-user"></i><span class="menu-title" data-i18n="eCommerce">
                            Users
                            @if (countOfActiveUsers > 0)
                            {
                                <span class="badge badge-pill badge-danger">@countOfActiveUsers</span>
                            }


                        </span>
                    </a>
                </li>
                <li class=" nav-item">
                    <a href="@Url.Action("roles","account")"><i class="la la-gavel"></i><span class="menu-title" data-i18n="Travel &amp; Booking">Roles</span></a>
                </li>

              
                <li class=" navigation-header">
                    <span>Activity Management</span><i class="la la-ellipsis-h" data-toggle="tooltip" data-placement="right" data-original-title="Activity Managements"></i>
                </li>
                <li class=" nav-item">
                    <a href="@Url.Action("index","ActivityName")"><i class="la la-compass"></i></i><span class="menu-title" data-i18n="Travel &amp; Booking">Activity Name</span></a>
                </li>

                <li class=" nav-item">
                    <a href="@Url.Action("index","VesselType")"><i class="la la-ship"></i><span class="menu-title" data-i18n="Travel &amp; Booking">Vessel Type</span></a>
                </li>


                <li class=" nav-item">
                    <a href="@Url.Action("index","FlagState")"><i class="la la-flag"></i><span class="menu-title" data-i18n="Travel &amp; Booking">Flag State</span></a>
                </li>

                <li class=" navigation-header">
                    <span>Activities</span><i class="la la-ellipsis-h" data-toggle="tooltip" data-placement="right" data-original-title="Activities"></i>
                </li>
                <li class=" nav-item">
                    <a href="@Url.Action("index","home")"><i class="la la-map-marker"></i><span class="menu-title" data-i18n="Travel &amp; Booking">Activity Points</span></a>
                </li>
                <li class=" nav-item">
                    <a href="@Url.Action("index","ShipActivity")"><i class="la la-binoculars "></i><span class="menu-title" data-i18n="Travel &amp; Booking">Activity </span></a>
                </li>
                <li class=" nav-item">
                    <a href="@Url.Action("index","ShipMovement")"><i class="la la-anchor"></i><span class="menu-title" data-i18n="Travel &amp; Booking">Ship Movement</span></a>
                </li>


             @*    @if (isAdmin)
                { *@
                    <li class=" navigation-header">
                        <span>Settings</span><i class="la la-ellipsis-h" data-toggle="tooltip" data-placement="right" data-original-title="Settings"></i>
                    </li>
                 

                    <li class=" nav-item">
                    <a href="@Url.Action("index","Location")"><i class="la la-windows"></i><span class="menu-title" data-i18n="Travel &amp; Booking">locations</span></a>
                    </li>

                    <li class=" nav-item">
                        <a href="@Url.Action("index","report")"><i class="la la-book"></i><span class="menu-title" data-i18n="Travel &amp; Booking">Reports</span></a>
                    </li>
               @*  } *@

            </ul>
        </div>
    </div>


    <div class="app-content content">
        <div class="content-overlay"></div>
        <div class="content-wrapper">
            <div class="content-header row">
            </div>
            <div class="content-body">
                @RenderBody()

            </div>
        </div>
    </div>
    <!-- END: Content-->

    <div class="sidenav-overlay"></div>
    <div class="drag-target"></div>

    <!-- BEGIN: Footer-->
 

    <button type="button" class="btn btn-secondary" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title=" النقيب بحري / محمد السعدي - رقم التواصل /322655 - مديرية تقنية المعلومات - قسم نظم المعلومات العملياتية">
        التواصل مع الدعم الفني للنظام
    </button>


@*     <footer class="footer bg-dark">
        <div class="container-fluid d-flex flex-md-row flex-column justify-content-between align-items-md-center gap-1 container-p-x py-1">
            <div style="font-size: initial; color:white">
                ©
                @DateTime.Now.Year
                 مديرية تقنية المعلومات
            </div>
            <a asp-action="index" asp-controller="Home" class="app-brand-link gap-4">
                <span>
                    <img src="~/images/logo/2040.jpg" alt="oman 2040 logo" width="60" height="50">
                </span>
                <span>
                    <img src="~/images/logo/rno.jpg" alt="MOD logo" width="50" height="50">
                </span>
                <div class="row">
                    <span class="app-brand-text pb-1" style="font-size: larger; color:white">البحرية السلطانية العمانية</span>
                </div>
            </a>
        </div>
    </footer> *@




    <script src="~/vendors/js/vendors.min.js"></script>
    <script src="~/vendors/js/charts/chart.min.js"></script>
    <script src="~/vendors/js/charts/raphael-min.js"></script>
    <script src="~/vendors/js/charts/morris.min.js"></script>
    <script src="~/vendors/js/charts/morris.min.js"></script>
    <script src="~/vendors/js/charts/jvector/jquery-jvectormap-2.0.3.min.js"></script>
    <script src="~/vendors/js/charts/jvector/jquery-jvectormap-world-mill.js"></script>



    <!-- END: Page Vendor JS-->
    <!-- BEGIN: Theme JS-->

    <script src="~/vendors/js/tables/datatable/datatables.min.js"></script>

    <script src="~/js/core/app-menu.js"></script>
    <script src="~/js/core/app.js"></script>
    <script src="~/js/scripts/tables/datatables/datatable-basic.js"></script>

    <!-- sweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


    @await RenderSectionAsync("Scripts", required: false)


    <script>
        function read(id) {

            $.ajax({
                url: '@Url.Action("MarkRead", "Notification")',
                method: 'GET',
                data: { notificationId: id },
                dataType: 'json',
                success: function (data) {
                    debugger;
                    if (data.isSuccess) {
                        toastr.success("Notification has been marked as read.");
                    } else {
                        toastr.error(data.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error occurred:', error);
                }
            });

        }

        function readAll() {
            $.ajax({
                url: '@Url.Action("MarkAllRead", "Notification")',
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    toastr.success("All notifications have been marked as read.");
                },
                error: function (xhr, status, error) {
                    console.error('Error occurred:', error);
                }
            });
        }
    </script>

</body>
<!-- END: Body-->

</html>